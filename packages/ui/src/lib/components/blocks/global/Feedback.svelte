<script lang="ts">
	import type {FeedbackProps, AriaLive, UiStatus, UiTextContext} from '$types'
	import {AriaLiveEnum} from '$types'
	import styleHelper from '$lib/utils/styles.js'

	let {
		id = 'Feedback',
		asset = 'default',
		justify = 'start',
		align,
		text,
		context,
		status,
		size,
		font,
		variant,
		container,
		children,
	}: FeedbackProps = $props()

	let feedbackClasses = $derived(
		styleHelper.getFeedbackStyles(
			{size, font, asset, variant, align, justify, container},
			status as UiStatus,
			context as UiTextContext,
		),
	)
	let ariaLive: AriaLive = $derived(
		context === 'form' ? AriaLiveEnum.polite : undefined,
	)
	let testId = $derived(id === 'Feedback' ? id : `Feedback-${id}`)
</script>

{#if context === 'code'}
	<pre
		class={feedbackClasses}
		data-testid={testId}>{#if children}{@render children()}{:else if text}{text}{/if}</pre>
{:else if context === 'form' || context === 'prose'}
	<div class={feedbackClasses} data-testid={testId} aria-live={ariaLive}>
		{#if context === 'prose' && status !== 'default'}
			<p class="status">{status}</p>
		{/if}
		<div class="message">
			{#if children}
				{@render children()}
			{:else if text}
				<p>{text}</p>
			{/if}
		</div>
	</div>
{/if}
